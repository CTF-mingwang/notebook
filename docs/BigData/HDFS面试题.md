<div class="output_wrapper" id="output_wrapper_id" style="font-size: 16px; color: rgb(62, 62, 62); line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><h1 id="hhdfs" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; font-size: 1.6em;"><span style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;">HDFS面试题</span></h1>
<h2 id="h" style="line-height: inherit; margin: 1.5em 0px; font-weight: bold; font-size: 1.4em; margin-bottom: 2em; margin-right: 5px; padding: 8px 15px; letter-spacing: 2px; background-image: linear-gradient(to right bottom, rgb(0, 188, 212), rgb(63, 81, 181)); background-color: rgb(63, 81, 181); color: rgb(255, 255, 255); border-left: 10px solid rgb(51, 51, 51); border-radius: 5px; text-shadow: rgb(102, 102, 102) 1px 1px 1px; box-shadow: rgb(102, 102, 102) 1px 1px 2px;"><span style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;">一、选择题</span></h2>
<ol style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px; padding-left: 32px; list-style-type: decimal;">
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">下列哪项通常是集群的最主要瓶颈（C）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.CPU</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.网络</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.磁盘IO</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">D.内存</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">下列哪项可以作为集群的管理？（AB）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.ClouderaManager</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.Zookeeper</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">下列哪个是Hadoop运行的模式？（ABC）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.单机版（独立模式）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.伪分布式</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.完全分布式</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">HDFS中的block默认保存几份？（A）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.3</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.2</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.1</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">D.不确定</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">HDFS默认BlockSize是（C）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.32MB</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.64MB（2.7.7版本，本地模式）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.128MB（2.7.7版本，分布式模式）</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">Client端上传文件的时候下列哪项正确？（B）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.数据经过NameNode传递DataNode</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.Client端将文件切分为Block，依次上传</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.Client端并发执行Block块的写入</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">下面哪个程序负责HDFS数据存储？（C）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.NameNode</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.JobTracker</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.DataNode</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">D.SecondaryNameNode</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">E.TaskTracker</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">关于SecondaryNameNode哪项是正确的？（C）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.它是NameNode的热备</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.它对内存没有要求</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.它的目的是帮助NameNode合并编辑日志，减少NameNode启动时间</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">D.SecondaryNameNode应与NameNode部署到一个节点</p></li>
<li style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; margin-bottom: 0.5em; color: rgb(233, 105, 0);"><p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">下列哪个程序通常与NameNode在一个节点启动？（D）</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">A.SecondaryNameNode</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">B.DataNode</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">C.NodeManager</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">D.ResourceManager（JobTracker）</p></li>
</ol>
<h2 id="h-1" style="line-height: inherit; margin: 1.5em 0px; font-weight: bold; font-size: 1.4em; margin-bottom: 2em; margin-right: 5px; padding: 8px 15px; letter-spacing: 2px; background-image: linear-gradient(to right bottom, rgb(0, 188, 212), rgb(63, 81, 181)); background-color: rgb(63, 81, 181); color: rgb(255, 255, 255); border-left: 10px solid rgb(51, 51, 51); border-radius: 5px; text-shadow: rgb(102, 102, 102) 1px 1px 1px; box-shadow: rgb(102, 102, 102) 1px 1px 2px;"><span style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;">二、简答题</span></h2>
<h3 id="h1" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">1. 分布式文件存储系统架构的理解</span></h3>
<div align="center" style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"> <img src="https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/HDFS-architecture.jpg" width="600px" style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; display: block; margin: 0px auto; max-width: 100%;"> </div>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">如上图所示，HDFS的设计符合主从架构，也就是Master/Slaves的结构。分HDFS Client、NameNode、DataNode、SecondaryNameNode这几个角色</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">HDFS Client</strong>：负责文件上传到集群时的切块（Hadoop1.x每块64MB，Hadoop2.x每块128MB）、与NameNode通信，获得文件的位置信息、与DataNode交互，实现数据的读取与写入、通过HDFS Cli来操作HDFS。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">NameNode</strong>：是Master节点，是集群的老大。管理HDFS的名称空间、管理数据块的映射、处理客户端的读写请求、配置副本策略。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">DataNode</strong>：Slaves节点，小弟。给老大干活儿的，负责存储Client发来的数据块Block。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">SecondaryNameNode</strong>：是一个秘书级别的角色，辅助老大NameNode，是NameNode的冷备份。负责合并fsimage和edits，然后再发给NameNode。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><code style="font-size: inherit; line-height: inherit; overflow-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%;">冷备份</code>：b是a的冷备份，如果a宕掉，b不能马上代替a工作，但b上保存有a的部分信息，可以减少a宕掉之后的损失。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><code style="font-size: inherit; line-height: inherit; overflow-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%;">热备份</code>：b是a的热备份，如果a宕掉，b能马上代替a工作</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">fsimage：元数据镜像文件（文件系统的目录树）。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">edits：元数据的操作日志（对文件系统做的创建、修改、删除等操作记录）。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">NameNode内存中存储的是fsimage+edits，SecondaryNameNode负责定时（默认1小时），从NameNode上获取fsimage和edits来进行合并，然后再发给NameNode，减少NameNode的工作量。</p>
<h3 id="h2hdfs" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">2. 阐述HDFS的存储机制</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">HDFS的存储机制包括HDFS的读取过程和写入过程两个部分</strong></p>
<h4 id="h21hdfs" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; font-size: 1.2em;"><span style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;">2.1 HDFS读文件流程</span></h4>
<div align="center" style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"> <img src="https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hdfs-read.jpg" style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; display: block; margin: 0px auto; max-width: 100%;"> </div>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、HDFS Client通过Distributed FileSystem访问NameNode查询元数据信息，获得这个文件的数据块位置列表，返回输入流对象。</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">元数据<br>#块列表<br>{blk-01,blk02}<br>#块所在的DataNode列表<br>{blk-01:node1,blk-01:node2,blk-01:node3,blk-02:node1,blk-02:node2,blk-02:node3}<br></code></pre>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">2、NameNode通过查询NameSpace的元数据，找到数据块所在的DataNode节点的位置，然后按照就近原则，挑选数据块对应的DataNode节点列表并返回。</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">元数据<br>#块列表<br>{blk-01,blk02};<br>#块所在的DataNode列表<br>{blk-01:node1,blk-02:node1}<br></code></pre>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">3，4，5、使用底层文件系统的FSDataInputStream，开始<strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">并行读</strong>取各个数据块（单位packet）。同时，读完一个Block都会进行checksum验证，如果读取DN时出错，HDFS Client通知NameNode，然后再从下一个拥有该Block副本的DN继续读取。<br>6、最终读取完所有的Block后合并成一个完整的文件，并关闭读取流 </p>
<h4 id="h22hdfs" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; font-size: 1.2em;"><span style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;">2.2 HDFS写文件流程</span></h4>
<div align="center" style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"> <img src="https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hdfs-write.jpg" style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; display: block; margin: 0px auto; max-width: 100%;"> </div>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、HDFS Client调用DistributedFileSystem对象的create方法，创建文件输出流对象FSDataOutputStream<br>2、HDFS Client通过DistributedFileSystem对象与NameNode进行RPC远程调用，向NN询问FS中是否有该文件</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">1.Namenode响应，文件不存在，可以上传<br>2.HDFS&nbsp;Client进行文件按Block切割，请求上传第1个Block,向NameNode请求存储位置列表<br>3.NameNode返回文件能存储的节点列表，比如node01、node02、node03<br></code></pre>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">3、通过FSDataOutputStream对象，向DataNode写入数据，数据首先被写入FSDataOutputStream对象内部的Buffer中，然后数据被分割成一个个Packet数据包。<br>4、以Packet为最小单位，基于Socket连接发送到按<strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">特定算法选择</strong>的HDFS集群中一组DataNode（正常是3个，可能大于等于1）中的一个节点上，在这组DataNode组成的Pipeline上依次传输Packet。<br>5、这组DataNode组成的Pipeline反方向上发送ack响应，最终由Pipeline中第一个DataNode节点将Pipeline ack响应结果发送给HDFS Client。<br>6、第2、3…个Block重复执行2，3，4，5（第2步只需要询问块所在的节点位置），完成数据块的写入。<br>7、最后一个数据块写入完毕后，HDFS Client调用输出流FSDataOutputStream对象的close方法，关闭流。最后，HDFS Client调用DistributedFileSystem对象的complete方法，通知NameNode文件写入成功</p>
<h3 id="h3hdfsapiconfigurationfilesystem" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">3. 解释HDFS客户端操作常用API含义Configuration、FileSystem</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">Configuration</strong>：该类的对象封装了客户端或者服务器的配置信息。通常可以使用该类的set方法设置k-v键值对来封装信息，addResource方法来指定加载的配置文件。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">FileSystem</strong>：该类的对象是一个文件系统对象，可以使用该对象的一些方法来对文件进行操作。通常使用FileSystem的静态方法get来获得该对象。</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">FileSystem&nbsp;fs=FileSystem.get(conf);<br>FileSystem&nbsp;fs=FileSystem.get(URI.create(hdfsurl),conf,username);<br><br>#创建目录<br>fs.mkdirs(new&nbsp;Path(路径));<br>#查看文件信息<br>fs.listStatus(new&nbsp;Path(路径));<br>#递归查看<br>fs.listFiles(new&nbsp;Path(路径),true);<br>#递归删除目录<br>fs.delete(new&nbsp;Path(路径),true);<br>#输入流<br>fs.open(new&nbsp;Path(路径));<br>#输出流<br>fs.create(new&nbsp;Path(路径));<br>#上传<br>fs.copyFromLocalFile(new&nbsp;Path(localPath),&nbsp;new&nbsp;Path(hdfsPath));<br>#下载<br>fs.copyToLocalFile(new&nbsp;Path(hdfsPath),&nbsp;new&nbsp;Path(localPath));<br></code></pre>
<h3 id="h4hadoop" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">4. Hadoop中需要哪些配置文件，其作用是什么？</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、hadoop-env.sh：只需要设置jdk的安装路径即可</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">2、core-site.xml</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">fs.defaultFS:hdfs://hadoop01:9000，这里指的是默认的HDFS路径<br>hadoop.tmp.dirfile:///opt/software/hadoop-2.7.7/tmp，这里的路径默认是NN、DN、SNN等存放数据的公共目录，用户也可以单独指定这三类路径<br>io.file.buffer.size:4096，默认缓存大小4KB<br>ha.zookeeper.quorum:hadoop01:2181,hadoop02:2181,hadoop03:2181，这里是Zookeeper集群的地址和端口。数量一定要是奇数，且不少于三个节点。<br></code></pre>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">3、hdfs-site.xml</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">dfs.block.size:134217728,数据块默认大小128M<br>dfs.replication:3，副本数量，不配置的话默认为3<br>fs.checkpoint.dir:file:///opt/software/hadoop-2.7.7/checkpoint/dfs/cname，SecondaryNameNode的fsimage和edits的存储目录<br>dfs.name.dir:file:///opt/software/hadoop-2.7.7/dfs/namenode_data，namenode节点存储Hadoop文件系统信息的本地系统路径<br>dfs.data.dir:file:///opt/software/hadoop-2.7.7/dfs/datanode_data，datanode节点数据的本地系统路径<br>dfs.namenode.secondary.http-address:hadoop02:50090，指定secondarynamenode的web地址<br>dfs.permissions:false，hdfs文件操作权限,false为不验证<br></code></pre>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">4、mapred-site.xml</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">mapreduce.framework.name:yarn，指定mapreduce运行在yarn上<br>mapreduce.jobhistory.address:hadoop01:10020，配置任务历史服务器地址<br>mapreduce.jobhistory.webapp.address:hadoop01:19888，配置任务历史服务器web-UI地址<br></code></pre>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">5、yarn-site.xml</p>
<pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="properties language-properties" style="overflow-wrap: break-word; padding: 2px 4px; margin: 0px 2px; color: rgb(233, 105, 0); background: rgb(248, 248, 248) none repeat scroll 0% 0%; line-height: 18px; font-size: 14px; font-weight: normal; word-spacing: 0px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">yarn.resourcemanager.hostname:hadoop01,指定yarn的老大resourcemanager的地址<br>yarn.nodemanager.aux-services:mapreduce_shuffle，NodeManager获取数据的方式<br>yarn.log-aggregation-enable:true，开启日志聚集功能<br>yarn.log-aggregation.retain-seconds:604800，配置日志保留7天<br></code></pre>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">6、slaves</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">配置从节点列表</p>
<h3 id="h5hadoophadoop" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">5. 请列出正常工作的Hadoop集群中Hadoop都分别需要启动哪些进程，它们的作用分别是什么？</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">NameNode</strong>：Hadoop中的老大，管理文件系统名称空间和对集群中存储的文件的访问，保存有metadata。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">DataNode</strong>：负责管理连接到节点的存储（一个集群中有多个节点）。每个存储数据的节点运行一个DataNode。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">SecondaryNameNode</strong>：它不是NameNode的冗余守护进程，而是提供定期检查点和清理任务，帮助NameNode合并fsimage和edits，减少NameNode的启动时间。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">ResourceManager</strong>：（JobTracker）负责调度DataNode上的工作。每个DataNode有一个TaskTracker，它们执行实际工作。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">NodeManager</strong>：（TaskTracker）执行任务</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">DFSZKFailoverController</strong>：高可用时负责监控NameNode的状态并及时把状态信息写入ZK。它通过一个独立线程周期性的调用NameNode上的一个特定接口来获取NameNode的健康状态。FC也有选择谁作为Active NameNode的权利，因为Hadoop2.x最多只有两个NameNode节点，目前选择策略还比较简单（先到先得，轮换）。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">JournalNode</strong>：高可用情况下存放NameNode的edits文件</p>
<h3 id="h6hadoop" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">6. 简述Hadoop的几个默认端口以及含义</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">dfs.namenode.http-address:50070</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">SecondaryNameNode辅助名称节点Web端口号：50090</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">dfs.datanode.address:50010</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">fs.defaultFS:8020或9000</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">yarn.resourcemanager.webapp.address:8088</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">historyserver:19888</p>
<h3 id="h764mb128mb" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">7. 文件大小默认为64MB，改为128MB有啥影响？</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、增加了文件块的大小，同时也就需要增加磁盘的传输速率</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">2、假如数据块设置过小，那需要读取的数据块就比较多，由于数据块在硬盘上非连续存储，普通硬盘因为需要移动磁头，所以随机寻址较慢，读越多的数据块就增大了总的硬盘寻道时间，所以就需要在减少寻址频率和提升磁盘传输速率之间找到一个阈值。</p>
<h3 id="h8secondarynamenode" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">8. 简述SecondaryNameNode的工作机制</span></h3>
<div align="center" style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"> <img src="https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/nn-snn.png" width="600px" style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; display: block; margin: 0px auto; max-width: 100%;"> </div>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">NameNode阶段</strong></p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、第一次启动NameNode格式化后，创建fsimage和edits文件加载到内存中。如果不是第一次启动，直接加载最新的edits和fsimage到内存。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">2、HDFS Client对元数据进行增删改的请求</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">3、NameNode中edits记录操作日志，更新滚动日志。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">4、NameNode在内存中对数据进行增删改查</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">SecondaryNameNode阶段</strong></p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">设置的定时时间(dfs.namenode.checkpoint.period)或edits中操作次数达到上限(dfs.namenode.checkpoint.txns)后，进行以下操作</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、NamdeNode生成一个新的文件：edits.new<br>2、每隔一段时间(默认1小时)，SNN将NN上最新的fsimage和滚动前的编辑日志edits通过http协议下载到本地，并加载到内存。<br>3、SNN将内存中的fsimage和edits进行merge（合并）,生成一个新的镜像文件(fsimage.ckpt)，这个过程称为checkpoint<br>4、然后SNN将新生成的fsimage.ckpt通过http协议发送到NamdeNode<br>5、NameNode将edits.new重命名为edits,将fsimage.ckpt重命名为fsimage</p>
<h3 id="h9namenodesecondarynamenode" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">9. NameNode与SecondaryNameNode的区别与联系？</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、机制流程见<strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">8</strong></p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">2、区别</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">NameNode负责管理整个文件系统的元数据以及每一个路径（文件）所对应的数据块信息。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">SecondaryNameNode用于定期合并命名空间镜像和命名空间镜像的编辑日志。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">3、联系</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">SecondaryNameNode中保存了一份和NameNode一致的镜像文件（fsimage）和编辑日志（edits）。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">在NameNode发生故障时（假设没有及时备份数据），可以从SecondaryNameNode恢复数据（默认一小时前的数据）。</p>
<h3 id="h10namenode" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">10. NameNode内存包含哪些，具体如何分配？</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">1.Namespace</strong>：维护整个文件系统的目录树结构及目录树上的状态变化</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">2.BlockManager</strong>：维护整个文件系统中与数据块相关的信息及数据块的状态变化</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">3.NetworkTopology</strong>：维护机架拓扑及DataNode信息，机架感知的基础</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;"><strong style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; font-weight: bold; color: rgb(0, 116, 217);">4.其它</strong>：</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">　　LeaseManager：读写的互斥同步就是靠Lease实现，支持HDFS的Write-Once-Read-Many的核心数据结构；</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">　　CacheManager：Hadoop 2.3.0引入的集中式缓存新特性，支持集中式缓存的管理，实现memory-locality提升读性能；</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">　　SnapshotManager：Hadoop 2.1.0引入的Snapshot新特性，用于数据备份、回滚，以防止因用户误操作导致集群出现数据问题；</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">　　DelegationTokenSecretManager：管理HDFS的安全访问；</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">　　另外还有临时数据信息、统计信息metrics等等。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">　　NameNode常驻内存主要被Namespace和BlockManager使用，二者使用占比分别接近50%。其它部分内存开销较小且相对固定，与Namespace和BlockManager相比基本可以忽略。</p>
<h3 id="h11hadoop" style="color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px; font-weight: bold; border-bottom: 2px solid rgb(0, 116, 217); margin-bottom: 50px; font-size: 1em;"><span style="font-size: inherit; line-height: inherit; margin: 0px; display: inline-block; background: rgb(0, 116, 217) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 10px 16px; border-radius: 5px; box-shadow: rgb(0, 116, 217) 5px 5px 10px;">11. 你认为Hadoop有哪些设计不合理的地方？</span></h3>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">1、不支持文件的并发写入和对文件内容的随机修改。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">2、不支持低延迟、高吞吐的数据访问。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">3、存取大量小文件，会占用 namenode 大量内存，小文件的寻道时间超过读取时间。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">4、Hadoop 环境搭建比较复杂。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">5、数据无法实时处理。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">6、mapreduce的shuffle阶段IO太多。</p>
<p style="font-size: inherit; color: inherit; line-height: inherit; padding: 0px; margin: 1.5em 0px;">7、编写mapreduce难度较高，实现复杂逻辑时代码量太大。</p></div>